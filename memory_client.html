<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo da Mem√≥ria - Cliente</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            margin: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .status {
            background: #000;
            border: 1px solid #00ff00;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            margin: 20px 0;
        }
        .card {
            background: #333;
            border: 1px solid #00ff00;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .card:hover {
            background: #444;
        }
        .card.revealed {
            background: #006600;
        }
        .card.hidden {
            background: #333;
            color: #333;
        }
        .controls {
            margin: 20px 0;
        }
        input, button {
            background: #000;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 5px 10px;
            margin: 5px;
            font-family: 'Courier New', monospace;
        }
        button:hover {
            background: #006600;
        }
        .log {
            background: #000;
            border: 1px solid #00ff00;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-size: 12px;
        }
        .connection {
            background: #000;
            border: 1px solid #00ff00;
            padding: 10px;
            margin: 10px 0;
        }
        .connected { color: #00ff00; }
        .disconnected { color: #ff0000; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Jogo da Mem√≥ria - Cliente WebSocket</h1>
        
        <div class="connection">
            <div id="connectionStatus" class="disconnected">‚ùå Desconectado</div>
            <button onclick="connect()">üîå Conectar</button>
            <button onclick="disconnect()">üîå Desconectar</button>
        </div>
        
        <div class="status">
            <div id="gameStatus">Aguardando conex√£o...</div>
        </div>
        
        <div class="board" id="board">
            <!-- Cards ser√£o gerados aqui -->
        </div>
        
        <div class="controls">
            <input type="number" id="cardInput" placeholder="Posi√ß√£o (0-15)" min="0" max="15">
            <button onclick="revealCard()">üé¥ Revelar Carta</button>
            <button onclick="sendCommand('STATE')">üìä Estado</button>
            <button onclick="sendCommand('BOARD')">üéØ Tabuleiro</button>
            <button onclick="sendCommand('RESET')">üîÑ Reiniciar</button>
            <button onclick="sendCommand('HELP')">‚ùì Ajuda</button>
        </div>
        
        <div class="log" id="log">
            <div>üìã Log de mensagens...</div>
        </div>
    </div>

    <script>
        let ws = null;
        let cards = Array(16).fill('***');
        let revealed = Array(16).fill(false);
        
        function log(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div>[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus');
            if (connected) {
                status.className = 'connected';
                status.textContent = '‚úÖ Conectado';
            } else {
                status.className = 'disconnected';
                status.textContent = '‚ùå Desconectado';
            }
        }
        
        function updateBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            
            for (let i = 0; i < 16; i++) {
                const card = document.createElement('div');
                card.className = 'card';
                if (revealed[i]) {
                    card.className += ' revealed';
                    card.textContent = cards[i];
                } else {
                    card.className += ' hidden';
                    card.textContent = '***';
                }
                card.onclick = () => revealCardAt(i);
                board.appendChild(card);
            }
        }
        
        function connect() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                log('J√° conectado!');
                return;
            }
            
            ws = new WebSocket('ws://localhost:9003');
            
            ws.onopen = function() {
                log('üîå Conectado ao servidor!');
                updateConnectionStatus(true);
            };
            
            ws.onmessage = function(event) {
                const message = event.data;
                log(`üì® Recebido: ${message}`);
                
                if (message.startsWith('STATE ')) {
                    document.getElementById('gameStatus').textContent = message.substring(6);
                }
                else if (message.startsWith('BOARD ')) {
                    const boardData = message.substring(7);
                    const cardArray = boardData.split('|');
                    cards = cardArray;
                    revealed = cardArray.map(card => card !== '***');
                    updateBoard();
                }
                else if (message.startsWith('REVEAL_OK ')) {
                    const parts = message.split(' ');
                    const pos = parseInt(parts[1]);
                    const word = parts[2];
                    cards[pos] = word;
                    revealed[pos] = true;
                    updateBoard();
                }
                else if (message.startsWith('MATCH ')) {
                    log(`üéâ MATCH! ${message}`);
                }
                else if (message.startsWith('MISMATCH ')) {
                    log(`‚ùå MISMATCH! ${message}`);
                    // Esconde as cartas ap√≥s um delay
                    setTimeout(() => {
                        const parts = message.split(' ');
                        const pos1 = parseInt(parts[1]);
                        const pos2 = parseInt(parts[2]);
                        revealed[pos1] = false;
                        revealed[pos2] = false;
                        updateBoard();
                    }, 2000);
                }
                else if (message.startsWith('GAME_OVER ')) {
                    log(`üèÜ ${message}`);
                }
                else if (message.startsWith('RESET_OK')) {
                    log('üîÑ Jogo reiniciado!');
                    cards = Array(16).fill('***');
                    revealed = Array(16).fill(false);
                    updateBoard();
                }
            };
            
            ws.onclose = function() {
                log('üîå Desconectado do servidor!');
                updateConnectionStatus(false);
            };
            
            ws.onerror = function(error) {
                log(`‚ùå Erro: ${error}`);
                updateConnectionStatus(false);
            };
        }
        
        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
        }
        
        function sendCommand(command) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                log(`üì§ Enviando: ${command}`);
                ws.send(command);
            } else {
                log('‚ùå N√£o conectado!');
            }
        }
        
        function revealCard() {
            const input = document.getElementById('cardInput');
            const pos = parseInt(input.value);
            if (pos >= 0 && pos <= 15) {
                sendCommand(`REVEAL ${pos}`);
                input.value = '';
            } else {
                log('‚ùå Posi√ß√£o inv√°lida! Use 0-15');
            }
        }
        
        function revealCardAt(pos) {
            if (pos >= 0 && pos <= 15) {
                sendCommand(`REVEAL ${pos}`);
            }
        }
        
        // Inicializa√ß√£o
        updateBoard();
        log('üéÆ Cliente carregado! Clique em "Conectar" para come√ßar.');
        
        // Conectar automaticamente
        setTimeout(connect, 1000);
    </script>
</body>
</html> 